<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>环境检测申请管理</title>
    <link rel="stylesheet" href="../../dist/css/base.css"/>
    <link rel="stylesheet" href="../../dist/css/database.css"/>
</head>
<body>
<div class="query-condition mt10 tac">
    <form id="column-form">
        <div class="query-condition-p">
            <span class="common-field w65">公司名称：</span>
            <input name="companyName"  class="common-input mr15"></select>
            <span class="common-field w65">报告名称：</span>
            <input name="reportName" class="common-input mr15"></select>
            <span class="common-field w65">寄送地址：</span>
            <input name="adress" class="common-input mr15"></select>
            <span class="common-field w65">申请日期：</span>
            <input type="text" id="createDateBegin" name="createDateBegin" class="query-date ml5"/>~<input type="text" id="createDateEnd" name="createDateEnd" class="query-date mr15"/>
            <p class="query-reset">
                <b class="cm-query-btn mr15" id="query-btn"></b>
                <b class="cm-reset-btn" id="reset-btn"></b>
            </p>
        </div>
    </form>
</div>
<div id="query-result">
    <div class="new-color-bar">
        <span class="title">申请信息列表（共找到<span class="total-count"></span>条数据）</span>
        <div class="bar-btn-div hide">
            <b id="user-add" class="cm-add-btn"></b>
        </div>
    </div>
    <table id="column-column-table" class="typical-tb">
        <thead>
        <th style="width: 5%">序号</th>
        <th style="width: 20%">公司名称</th>
        <th style="width: 15%">寄送报告地址</th>
        <th style="width: 15%">寄送发票地址</th>
        <th style="width: 10%">联系方式</th>
        <th style="width: 10%">申请日期</th>
        <th style="width: 10%">申请内容</th>
        <th style="width: 7%">申请状态</th>
        <th style="width: 8%">操作</th>
        </thead>
        <tbody tpsource="#column-column-list"></tbody>
    </table>
    <div class="paging"></div>
</div>
</body>
<script type="text/template" id="column-column-list">
    <tr >
        <td>{rownum}</td>
        <td>{companyName}</td>
        <td>{reportAdress}</td>
        <td>{invoiceAdress}</td>
        <td>{telphone}</td>
        <td>{createDateStr}</td>
        <td><a class="into-report-view" param="{id}">查看申请内容</a></td>
        <td>{statusStr}</td>
        <td>
            <a class="into-user-edit icon-edit-btn" param="{id}" title="受理"></a>
            <a class="delete-for-company icon-remove-btn" param="{id}" companyName="{companyName}" title="删除"></a><br>
        </td>
    </tr>
</script>

<div id="report-view-div" class="hide">
    <p class="mt10">
        <span class="common-field">公司名称：</span>
        <input name="companyName" class=" common-input" type="text" readonly="true" value="{companyName}"/>
        <span class="common-field">申请人：</span>
        <input name="userName" class=" common-input" type="text" readonly="true" value="{userName}"/>
    </p>
    <p class="mt10">
        <span class="common-field">信用识别码：</span>
        <input name="companyCode" class="common-input" type="text" readonly="true" value="{companyCode}"/>
        <span class="common-field">联系方式：</span>
        <input name="telphone" class="common-input" type="text" readonly="true" value="{telphone}"/>
    </p>
    <p class="mt10">
        <span class="common-field">寄送报告地址：</span>
        <input name="reportAdress" class="common-input" type="text" readonly="true" value="{reportAdress}"/>
        <span class="common-field">寄送发票地址：</span>
        <input name="invoiceAdress" class="common-input" type="text" readonly="true" value="{invoiceAdress}"/>
    </p>
    <p class="mt10">
        <span class="common-field">邮箱：</span>
        <input name="email" class="common-input" type="text" readonly="true" value="{email}"/>
        <span class="common-field">申请日期：</span>
        <input name="createDateStr" class="common-input common-input" type="text" readonly="true" value="{createDateStr}"/>
    </p>
    <p class="mt10">
        <span class="common-field fl">申请内容：</span>
        <textarea class="common-textarea" unselectable="on" readonly="true" rows="5">{remarks}</textarea>
    </p>

    <p class="tcenter mt10">
        <b id="report-view-cancel" class="cm-cancel-btn"  onclick="closeWin2()"></b>
    </p>
</div>
<script src="../../dist/js/base.js"></script>
<script>
    function closeWin2(){
        $('#report-view-div').$close()
    }


    // 在doc准备好后,写js逻辑
    importing('datepicker',function () {
        var queryListAction = top.path+'/api/business/application/list',
            addAction = top.path+'/api/business/report/add',
            pdfViewAction = top.path+'/wx/business/WeChart/view',
            deleteAction = top.path+'/api/0/business/report/delete',
            pageData = [];

        $('.query-date').datepicker();

        function loadColumnList(currentPage) {
            $('#query-result').pagingList({
                action:queryListAction,
                currentPage:currentPage,
                jsonObj:$('#column-form').serializeObject(),
                callback:pageBack
            });
        }

        function pageBack(data) {
            pageData = data;
            $('#column-column-table').find('tbody').template(data, function(item,i){
            });
        }

        function init() {
            //加载字段信息列表数据
            loadColumnList();
        }

        init();

        //查询
        $('#query-btn').on('click',function () {
            loadColumnList();
        });
        //重置
        $('#reset-btn').on('click',function () {
            $('#column-form')[0].reset();
            $('#match-page').html('');
        });

        //关闭窗口
        function closeWin(id){
            $('#'+id).$close();
        }

        function trimAll(selector) {
            $(selector+' input,'+selector+' textarea').each(function (i,el) {
                var value = $(el).val();
                $(el).val(value.trim());
            });
        }

        //进入查看页面
        function intoReportView(id) {
            for(var i=0;i<pageData.length;i++){
                if(pageData[i].id==id){
                    $('#report-view-div').template(pageData[i], function(item, i){
                    });
                    $open('#report-view-div',{width:800,height:350,title:'环境检测报告信息'});
                }
            }
        }

        //进入报告查看页面
        function viewReport(id) {
            window.open(pdfViewAction+"?id="+id, '_blank');
        }

        $('#column-column-table').on('click','.delete-for-company',function(){
            deleteForCompany(this.getAttribute('param'),this.getAttribute('companyName'));
        }).on('click','.into-report-view',function(){
            intoReportView(this.getAttribute('param'));
        }).on('click','.view-report',function() {
            viewReport(this.getAttribute('param'));
        });

        //删除用户
        function deleteForCompany(id,companyName){
            $confirm('确定删除【'+companyName+'】公司信息吗？',function(bol){
                if(bol){
                    $post(deleteAction,{id:id},function(res){
                        toast('删除成功！').ok();
                        loadColumnList($('.paging').data('currentPage'));
                    },true);
                }
            });
        }


    });

</script>
</html>
